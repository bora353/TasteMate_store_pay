<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.tastemate.mapper.StoreMapper">

    <resultMap id="storeMenuResultMap" type="com.tastemate.domain.StoreVO">
        <id column="STORE_IDX" property="storeIdx"/>
        <result column="STORE_NAME" property="storeName"/>
        <result column="CATEGORY1" property="category1"/>
        <result column="STORE_ADDRESS" property="storeAddress"/>
        <result column="STORE_LATI" property="storeLati"/>
        <result column="STORE_LONGI" property="storeLongi"/>
        <result column="PHONE_NUMBER" property="phoneNumber"/>
        <result column="STORE_COUNT" property="storeCount"/>
        <result column="FILENAME" property="filename"/>
        <collection property="menuVO" ofType="MenuVO">
            <id column="MENU_IDX" property="menuIdx" />
            <result column="STORE_IDX" property="storeIdx" />
            <result column="FOOD_NAME" property="foodName" />
            <result column="PRICE" property="price" />
        </collection>
    </resultMap>

    <select id="getStoreWithMenu" resultMap="storeMenuResultMap">
        SELECT s.store_idx, s.user_idx, s.store_name,
        s.category1, s.store_address, s.store_lati, s.store_longi, s.phone_number,
        s.store_count, s.filename, m.menu_idx, m.food_name, m.price
        FROM STORE s
        LEFT OUTER JOIN MENU m ON s.store_idx = m.store_idx
        WHERE s.store_idx = #{storeIdx}
    </select>

<!--    <resultMap id="menu" type="com.tastemate.domain.MenuVO">
        <id column="MENU_IDX" property="menuIdx"/>
        <result column="STORE_IDX" property="storeIdx"/>
        <result column="FOOD_NAME" property="foodName"/>
        <result column="PRICE" property="price"/>
    </resultMap>-->



    <select id="store_getList" resultType="StoreVO">
        select * from store
    </select>

    <select id="store_get" resultType="StoreVO">
        select * from store
        where store_idx = #{storeIdx}
    </select>

    <insert id="store_register" parameterType="StoreVO">
        INSERT INTO STORE (STORE_IDX, USER_IDX, STORE_NAME, CATEGORY1,
                           STORE_ADDRESS, STORE_LATI, STORE_LONGI, PHONE_NUMBER, STORE_COUNT,
        FILENAME
                           )
        VALUES (store_seq.NEXTVAL, #{userIdx}, #{storeName}, #{category1},
                #{storeAddress}, #{storeLati}, #{storeLongi}, #{phoneNumber}, 0,
        #{filename}
                )
    </insert>



</mapper>